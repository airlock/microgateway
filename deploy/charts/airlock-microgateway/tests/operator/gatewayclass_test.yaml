suite: helm.operator.TestGatewayClass
templates:
  - operator/gatewayclass.yaml
tests:
  - it: should not create GatewayClass by default
    asserts:
      - hasDocuments:
          count: 0

  - it: should not create GatewayClass if gatewayAPI.enabled is false
    set:
      operator.gatewayAPI.enabled: false
      operator.gatewayAPI.gatewayClass.create: true
    asserts:
      - hasDocuments:
          count: 0

  - it: should not create GatewayClass if gatewayAPI.gatewayClass.create is false
    set:
      operator.gatewayAPI.enabled: false
      operator.gatewayAPI.gatewayClass.create: false
    asserts:
      - hasDocuments:
          count: 0

  - it: should create GatewayClass with default name and controller name by default if gatewayAPI.enabled is true
    set:
      operator.gatewayAPI.enabled: true
    asserts:
      - equal:
          path: metadata.name
          value: airlock-microgateway
      - equal:
          path: spec.controllerName
          value: microgateway.airlock.com/gatewayclass-controller
      - equal:
          path: spec.description
          value: GatewayClass for Airlock Microgateway.

  - it: should create GatewayClass with default name and controller name
    set:
      operator.gatewayAPI.enabled: true
      operator.gatewayAPI.gatewayClass.create: true
    asserts:
      - equal:
          path: metadata.name
          value: airlock-microgateway
      - equal:
          path: spec.controllerName
          value: microgateway.airlock.com/gatewayclass-controller
      - equal:
          path: spec.description
          value: GatewayClass for Airlock Microgateway.

  - it: should create GatewayClass with specified name and controller name
    set:
      operator.gatewayAPI.enabled: true
      operator.gatewayAPI.controllerName: microgateway.airlock.com/my-gatewayclass-controller
      operator.gatewayAPI.gatewayClass.create: true
      operator.gatewayAPI.gatewayClass.name: my-gateway-class
    asserts:
      - equal:
          path: metadata.name
          value: my-gateway-class
      - equal:
          path: spec.controllerName
          value: microgateway.airlock.com/my-gatewayclass-controller
      - equal:
          path: spec.description
          value: GatewayClass for Airlock Microgateway.
